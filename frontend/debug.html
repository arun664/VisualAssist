<!DOCTYPE html>
<html>
<head>
    <title>Debug Connection Test</title>
</head>
<body>
    <h1>Connection Debug Test</h1>
    <div id="status">Testing...</div>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            log.appendChild(div);
            console.log(message);
        }
        
        // Test 1: HTTP connection to backend
        addLog('Testing HTTP connection to backend...');
        fetch('http://localhost:8000/health')
            .then(response => response.json())
            .then(data => {
                addLog('✅ HTTP connection successful: ' + JSON.stringify(data));
                
                // Test 2: WebSocket connection
                addLog('Testing WebSocket connection...');
                const ws = new WebSocket('ws://localhost:8000/ws');
                
                ws.onopen = function() {
                    addLog('✅ WebSocket connected successfully');
                    status.textContent = 'WebSocket Connected';
                    
                    // Test 3: Video stream
                    addLog('Testing video stream...');
                    const img = new Image();
                    img.onload = function() {
                        addLog('✅ Video stream loaded successfully');
                    };
                    img.onerror = function() {
                        addLog('❌ Video stream failed to load');
                    };
                    img.src = 'http://localhost:8000/processed_video_stream?t=' + Date.now();
                };
                
                ws.onerror = function(error) {
                    addLog('❌ WebSocket error: ' + error);
                    status.textContent = 'WebSocket Error';
                };
                
                ws.onclose = function() {
                    addLog('WebSocket closed');
                };
                
            })
            .catch(error => {
                addLog('❌ HTTP connection failed: ' + error);
                status.textContent = 'HTTP Connection Failed';
            });
    </script>
</body>
</html>
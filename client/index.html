<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Navigation Assistant - Client Device</title>
    <link rel="stylesheet" href="client-styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>AI Navigation Assistant</h1>
            <p class="subtitle">Client Device - Sensor Capture</p>
        </header>

        <!-- Authentication Modal -->
        <div id="authModal" class="auth-modal">
            <div class="auth-content">
                <h2>üîê Backend Authentication</h2>
                <p>Enter the access code to connect to the backend service:</p>
                <div class="auth-form">
                    <input type="password" id="authCodeInput" placeholder="Enter access code" maxlength="50">
                    <button id="authSubmitBtn" class="auth-btn">Connect</button>
                </div>
                <div id="authError" class="auth-error hidden">Invalid access code. Please try again.</div>
                <div class="auth-note">
                    <small>üõ°Ô∏è Secure connection required for AI navigation services</small>
                </div>
            </div>
        </div>

        <!-- Mixed Content Warning -->
        <div id="mixedContentWarning" class="mixed-content-warning hidden">
            <div class="warning-content">
                <h3>‚ö†Ô∏è Connection Security Notice</h3>
                <p>This page is served over HTTPS, but the backend runs on HTTP. Your browser may block mixed content.</p>
                <div class="warning-solutions">
                    <h4>Solutions:</h4>
                    <ol>
                        <li><strong>Allow Mixed Content</strong> for this site in your browser</li>
                        <li><strong>Use Chrome</strong> with disabled security: <code>--disable-web-security</code></li>
                        <li><strong>Use HTTP version</strong> of this page (if available)</li>
                    </ol>
                </div>
                <div class="warning-buttons">
                    <button id="dismissWarningBtn" class="warning-btn secondary">Dismiss</button>
                    <button id="retryConnectionBtn" class="warning-btn primary">Retry Connection</button>
                </div>
            </div>
        </div>

        <!-- Media Preview Section -->
        <div class="media-preview">
            <div class="video-container">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="video-overlay" id="videoOverlay">
                    <span>Camera not active</span>
                </div>
            </div>
            <div class="audio-indicator">
                <div class="audio-level" id="audioLevel"></div>
                <span id="audioStatus">Microphone: Off</span>
            </div>
        </div>

        <!-- Media Controls -->
        <div class="media-controls">
            <div class="permission-controls">
                <button id="requestCameraBtn" class="control-btn camera-btn">
                    <span class="btn-icon">üìπ</span>
                    Enable Camera
                </button>
                <button id="requestMicBtn" class="control-btn mic-btn">
                    <span class="btn-icon">üé§</span>
                    Enable Microphone
                </button>
            </div>
            <div class="stream-controls">
                <button id="startStreamBtn" class="control-btn primary" disabled>
                    Start Streaming
                </button>
                <button id="stopStreamBtn" class="control-btn secondary" disabled>
                    Stop Streaming
                </button>
            </div>
        </div>

        <!-- Connection Management -->
        <div class="connection-section">
            <div class="server-config">
                <label for="serverUrl">Backend Server URL:</label>
                <input type="text" id="serverUrl" value="" placeholder="Backend URL will be auto-detected">
                <p class="connection-note">üîí <strong>HTTPS/HTTP Notice:</strong> If you see "Mixed Content" errors, this page (HTTPS) cannot connect to HTTP backend. Enable mixed content in your browser or use the HTTP version of this page.</p>
            </div>
            <div class="connection-controls">
                <button id="connectBtn" class="control-btn connect-btn" disabled>
                    Manual Connect (Optional)
                </button>
                <button id="disconnectBtn" class="control-btn disconnect-btn" disabled>
                    Disconnect
                </button>
            </div>
        </div>

        <!-- Status Indicators -->
        <div class="status-section">
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-indicator" id="cameraIndicator"></div>
                    <span>Camera</span>
                    <span id="cameraStatus">Not Ready</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator" id="micIndicator"></div>
                    <span>Microphone</span>
                    <span id="micStatus">Not Ready</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator" id="connectionIndicator"></div>
                    <span>WebRTC</span>
                    <span id="connectionStatus">Disconnected</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator" id="streamIndicator"></div>
                    <span>Stream</span>
                    <span id="streamStatus">Inactive</span>
                </div>
            </div>
        </div>

        <!-- Optional Biometric Section -->
        <div class="biometric-section" id="biometricSection" style="display: none;">
            <h3>Biometric Sensors (Optional)</h3>
            <div class="biometric-controls">
                <button id="enableBiometricBtn" class="control-btn biometric-btn">
                    <span class="btn-icon">‚ù§Ô∏è</span>
                    Enable Heart Rate
                </button>
                <div class="biometric-status">
                    <span id="heartRateValue">-- BPM</span>
                    <span id="biometricStatus">Not Available</span>
                </div>
            </div>
        </div>

        <!-- Debug Information -->
        <div class="debug-section" id="debugSection">
            <details>
                <summary>Debug Information</summary>
                <div class="debug-content">
                    <div class="debug-item">
                        <strong>Browser Support:</strong>
                        <span id="browserSupport">Checking...</span>
                    </div>
                    <div class="debug-item">
                        <strong>Connection State:</strong>
                        <span id="connectionState">new</span>
                    </div>
                    <div class="debug-item">
                        <strong>ICE State:</strong>
                        <span id="iceState">new</span>
                    </div>
                    <div class="debug-item">
                        <strong>Last Error:</strong>
                        <span id="lastError">None</span>
                    </div>
                </div>
            </details>
        </div>
    </div>
    <script src="../config.js"></script>
    <script src="client.js"></script>
    <script>
        // Auto-configure backend URL on page load
        document.addEventListener('DOMContentLoaded', () => {
            const serverUrlInput = document.getElementById('serverUrl');
            const backendUrl = window.AI_NAV_CONFIG.getBackendUrl();
            serverUrlInput.value = backendUrl;
            console.log('üîß Auto-configured backend URL:', backendUrl);
        });
    </script>
</body>
</html>
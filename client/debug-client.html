<!DOCTYPE html>
<html>
<head>
    <title>Client Debug Test</title>
</head>
<body>
    <h1>Client Debug Test</h1>
    <div id="status">Testing client functionality...</div>
    <div id="log"></div>
    
    <button onclick="testBackendConnection()">Test Backend Connection</button>
    <button onclick="testMediaPermissions()">Test Media Permissions</button>
    <button onclick="testWebRTC()">Test WebRTC</button>
    
    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            log.appendChild(div);
            console.log(message);
        }
        
        function testBackendConnection() {
            addLog('Testing backend connection...');
            fetch('http://localhost:8000/health')
                .then(response => response.json())
                .then(data => {
                    addLog('✅ Backend connection successful: ' + JSON.stringify(data));
                })
                .catch(error => {
                    addLog('❌ Backend connection failed: ' + error);
                });
        }
        
        function testMediaPermissions() {
            addLog('Testing media permissions...');
            
            navigator.mediaDevices.getUserMedia({
                video: { width: 640, height: 480 },
                audio: true
            })
            .then(stream => {
                addLog('✅ Media permissions granted');
                addLog('Video tracks: ' + stream.getVideoTracks().length);
                addLog('Audio tracks: ' + stream.getAudioTracks().length);
                
                // Stop the stream
                stream.getTracks().forEach(track => track.stop());
            })
            .catch(error => {
                addLog('❌ Media permissions failed: ' + error.message);
            });
        }
        
        function testWebRTC() {
            addLog('Testing WebRTC offer creation...');
            
            const pc = new RTCPeerConnection({
                iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
            });
            
            pc.createOffer()
                .then(offer => {
                    addLog('✅ WebRTC offer created successfully');
                    return pc.setLocalDescription(offer);
                })
                .then(() => {
                    addLog('✅ Local description set');
                    
                    // Test sending offer to backend
                    return fetch('http://localhost:8000/webrtc/offer', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            client_id: 'test_client',
                            type: pc.localDescription.type,
                            sdp: pc.localDescription.sdp
                        })
                    });
                })
                .then(response => response.json())
                .then(data => {
                    addLog('✅ WebRTC offer sent to backend: ' + JSON.stringify(data));
                })
                .catch(error => {
                    addLog('❌ WebRTC test failed: ' + error.message);
                });
        }
        
        // Auto-run tests
        setTimeout(() => {
            testBackendConnection();
        }, 1000);
    </script>
</body>
</html>